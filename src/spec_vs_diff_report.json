{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-04T18:13:41.157Z",
  "summary": "The diff implements most of the frontend core flow, deterministic Focus Compression/Recovery (frontend), client timer, demo mode (3 canned sessions), local-first storage, history UI, and browser .txt export, plus build notes. However, several cross-cutting requirements that involve backend parity/sync and backend-stored admin content/LLM controls are missing or only implemented client-side (localStorage) with placeholders for backend-only LLM behavior.",
  "missing_requirements": [
    {
      "id": "REQ-12",
      "requirement": "Backend exposes an equivalent deterministic Focus Compression function/endpoint for optional sync parity.",
      "reason": "Deterministic focus compression is implemented only in the frontend utility; the backend diff shows session/API key methods but no deterministic focus compression function/endpoint.",
      "evidence": [
        "frontend/src/utils/deterministicFocusCompression.ts",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-13",
      "requirement": "Backend implements deterministic Recovery Logic (stuck -> exactly 2 micro-steps; avoided -> neutral reframe + exactly 2 micro-steps) for parity.",
      "reason": "Deterministic recovery logic exists only in the frontend; backend changes do not show a recovery function/endpoint.",
      "evidence": [
        "frontend/src/utils/deterministicRecovery.ts",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-16",
      "requirement": "Opt-in backend sync that, when enabled, syncs sessions to the Motoko backend and can be fetched after clearing local storage (when authenticated). Disabling sync prevents backend writes.",
      "reason": "Frontend includes only a localStorage toggle for sync and local session storage. No evidence of frontend sync calls or backend endpoints to store/fetch user sessions for this local-first sync feature. Backend shows a sessions map but no clear write/read API that matches the session data stored client-side, nor any frontend integration.",
      "evidence": [
        "frontend/src/store/syncSettings.ts",
        "frontend/src/pages/HistoryPage.tsx",
        "frontend/src/store/sessionStore.ts",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-19",
      "requirement": "LLM integration optional and disabled by default with admin-controlled enable/disable, max 3 LLM calls per session, backend-only LLM calls restricted to Focus Compression and Recovery, deterministic fallback on error/timeout.",
      "reason": "Frontend pages explicitly state LLM enhancement is TODO/placeholder and currently always deterministic (no LLM calls). There is no backend LLM call implementation shown in the backend diff summary. Also, max-3-calls-per-session enforcement is not evidenced in the shown code (App.tsx is truncated; FocusCompressionPage/RecoveryPage hardcode llmCallCount=0).",
      "evidence": [
        "frontend/src/pages/FocusCompressionPage.tsx",
        "frontend/src/pages/RecoveryPage.tsx",
        "backend/main.mo",
        "frontend/src/App.tsx"
      ]
    },
    {
      "id": "REQ-20",
      "requirement": "Backend-only OpenAI requests only if OPENAI_API_KEY configured; reject/avoid call if missing; post-validate/normalize output to a single neutral sentence; deterministic fallback used if invalid.",
      "reason": "A frontend-only LLM output policy utility exists, but there is no evidence of backend OpenAI call logic or backend-side output validation/normalization and fallback behavior in the backend diff.",
      "evidence": [
        "frontend/src/utils/llmOutputPolicy.ts",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-21",
      "requirement": "Admin panel manages demo video link and pitch text stored in backend state; landing page displays these fields publicly without exposing admin controls; persistence across reloads and canister upgrades (if backend sync used).",
      "reason": "Demo video link and pitch text are stored in frontend localStorage (adminSettings store) and read by LandingPage from local state, not from backend canister state. No backend fields/endpoints for these values are shown.",
      "evidence": [
        "frontend/src/store/adminSettings.ts",
        "frontend/src/pages/LandingPage.tsx",
        "frontend/src/components/AdminSettingsDialog.tsx",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-24",
      "requirement": "Document platform constraint handling for secrets: if backend secrets cannot be written programmatically, keep admin paste-key flow as canister-stored secret and document mechanism and why.",
      "reason": "Build notes mention backend-only storage via storeApiKey(), but the diff excerpt does not clearly document the platform constraint/closest-safe alternative rationale described in REQ-24.",
      "evidence": [
        "frontend/BUILD_NOTES.md"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Landing page footer promoting an external site (“Built with love using caffeine.ai”).",
      "reason": "Not requested in the BuildRequest requirements/non-goals; appears as added UI content.",
      "evidence": [
        "frontend/src/pages/LandingPage.tsx"
      ]
    }
  ],
  "confidence": 0.68,
  "changed_files": [
    "backend/main.mo",
    "frontend-file-summaries.txt",
    "frontend/BUILD_NOTES.md",
    "frontend/src/App.tsx",
    "frontend/src/components/AdminSettingsDialog.tsx",
    "frontend/src/demo/demoSessions.ts",
    "frontend/src/hooks/useCountdownTimer.ts",
    "frontend/src/pages/ActionModePage.tsx",
    "frontend/src/pages/CheckInPage.tsx",
    "frontend/src/pages/ContextPage.tsx",
    "frontend/src/pages/FocusCompressionPage.tsx",
    "frontend/src/pages/HistoryPage.tsx",
    "frontend/src/pages/LandingPage.tsx",
    "frontend/src/pages/MentalDumpPage.tsx",
    "frontend/src/pages/RecoveryPage.tsx",
    "frontend/src/pages/SessionEndPage.tsx",
    "frontend/src/store/adminSettings.ts",
    "frontend/src/store/demoMode.ts",
    "frontend/src/store/sessionStore.ts",
    "frontend/src/store/syncSettings.ts",
    "frontend/src/utils/deterministicFocusCompression.ts",
    "frontend/src/utils/deterministicRecovery.ts",
    "frontend/src/utils/exportSessionsTxt.ts",
    "frontend/src/utils/llmOutputPolicy.ts",
    "project_state.json"
  ]
}